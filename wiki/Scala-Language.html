<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en" xmlns="http://www.w3.org/1999/html"><!--<![endif]-->
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
  <title>Scala Language |  OrientDB</title>
  <title>Scala Language</title>
  <link href="../stylesheets/foundation.min.css" media="screen" rel="stylesheet" type="text/css" />
<link href="../stylesheets/app.css" media="screen" rel="stylesheet" type="text/css" />
  <script src="../javascripts/modernizr.foundation.js" type="text/javascript"></script>
  
</head>
<body class="orientdb orientdb_wiki orientdb_wiki_Scala-Language">

<header>
  <div class="row">
    <div class="five columns">
      <h1>
        <a href="/orientdb/">
          Orient<span class="highl">DB</span>
        </a>
        <span class="subtitle">The Document/Graph NoSQL Database</span>
      </h1>
    </div>
    <div class="seven columns right">
      <ul class="inline-list">
        <li><a href="/orientdb/"> Home</a></li>
<li><a href="/orientdb/about.html"> About</a></li>
<li class="active"><a href="/orientdb/wiki/Home.html"> Documentation</a></li>
<li><a href="/orientdb/wiki/Download.html"> Downloads</a></li>
<li><a href="/orientdb/community.html"> Community</a></li>
      </ul>
    </div>
  </div>
</header>


<div class="page-header">
  <div class="row">
    <div class="twelve columns">
      <h2>
        <i class="icon-orientdb"></i>
        Scala Language
        
          <ul class="bcs">
          
            <li><a href="/orientdb/wiki/Home.html" class="nr1">Home</a></li>
          
          </ul>
        
        
      </h2>
    </div>
  </div>
</div>

<div id="main" class="row wiki">

  <div class="twelve columns content" role="content">

    <p>OrientDB is a NoSQL database writen in Java, we can use it in scala easily. Look also at <a href="https://github.com/eptx/OrientDBScala">Scala utilities and tests</a> project for Scala high level classes built on top of OrientDB.</p>

<h3>Java method invocation problems</h3>

<p>Usually the main problems are related to calling conventions between Scala and Java.</p>

<h3>Parameters</h3>

<p>Be careful to pass parameters to methods with varargs like <code>db.query(...)</code>. You need to convert it to java's repeated args correctly.</p>

<p>Look at these links:
<a href="http://stackoverflow.com/questions/3022865/calling-java-vararg-method-from-scala-with-primitives">http://stackoverflow.com/questions/3022865/calling-java-vararg-method-from-scala-with-primitives</a>
<a href="http://stackoverflow.com/questions/1008783/using-varargs-from-scala">http://stackoverflow.com/questions/1008783/using-varargs-from-scala</a>
<a href="http://stackoverflow.com/questions/3856536/how-to-pass-a-string-scala-vararg-to-a-java-method-using-scala-2-8">http://stackoverflow.com/questions/3856536/how-to-pass-a-string-scala-vararg-to-a-java-method-using-scala-2-8</a></p>

<h3>Collections</h3>

<p>You can only use java collections when define pojos. If you use scala collections, they can be persisted, but can't be queried.</p>

<p>This's not a problem, if you imported:
</p><div class="highlight"><pre>  <span class="kn">import</span> <span class="nn">scala.collection.JavaConverters._</span>
  <span class="kn">import</span> <span class="nn">scala.collection.JavaConversions._</span>
</pre></div>
You don't need to convert Java and Scala collections manually (even don't need to invoke <code>.asJava</code> or <code>.asScala</code>) You can treat these java collections as scala's.

<h3>models.scala</h3>

<div class="highlight"><pre>  <span class="kn">package</span> <span class="n">models</span>
  
  <span class="kn">import</span> <span class="nn">javax.persistence.</span><span class="o">{</span><span class="n">Version</span><span class="o">,</span> <span class="n">Id</span><span class="o">}</span>
  
  <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
  	<span class="nd">@Id</span> <span class="n">var</span> <span class="nl">id:</span> <span class="n">String</span> <span class="o">=</span> <span class="n">_</span>
  	<span class="n">var</span> <span class="nl">name:</span> <span class="n">String</span> <span class="o">=</span> <span class="n">_</span>
  	<span class="n">var</span> <span class="nl">addresses:</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span><span class="o">[</span><span class="n">Address</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">ArrayList</span><span class="o">()</span>
  	<span class="nd">@Version</span> <span class="n">var</span> <span class="nl">version:</span> <span class="n">String</span> <span class="o">=</span> <span class="n">_</span>
  
  	<span class="n">override</span> <span class="n">def</span> <span class="n">toString</span> <span class="o">=</span> <span class="s">"User: "</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">+</span> <span class="s">", name: "</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">+</span> <span class="s">", addresses: "</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">addresses</span>
  <span class="o">}</span>
  
  <span class="kd">class</span> <span class="nc">Address</span> <span class="o">{</span>
  	<span class="n">var</span> <span class="nl">city:</span> <span class="n">String</span> <span class="o">=</span> <span class="n">_</span>
  	<span class="n">var</span> <span class="nl">street:</span> <span class="n">String</span> <span class="o">=</span> <span class="n">_</span>
  
  	<span class="n">override</span> <span class="n">def</span> <span class="n">toString</span> <span class="o">=</span> <span class="s">"Address: "</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">city</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">street</span>
  <span class="o">}</span>
  
  <span class="kd">class</span> <span class="nc">Question</span> <span class="o">{</span>
  	<span class="nd">@Id</span> <span class="n">var</span> <span class="nl">id:</span> <span class="n">String</span> <span class="o">=</span> <span class="n">_</span>
  	<span class="n">var</span> <span class="nl">title:</span> <span class="n">String</span> <span class="o">=</span> <span class="n">_</span>
  	<span class="n">var</span> <span class="nl">user:</span> <span class="n">User</span> <span class="o">=</span> <span class="n">_</span>
  	<span class="nd">@Version</span> <span class="n">var</span> <span class="nl">version:</span> <span class="n">String</span> <span class="o">=</span> <span class="n">_</span>
  
  	<span class="n">override</span> <span class="n">def</span> <span class="n">toString</span> <span class="o">=</span> <span class="s">"Question: "</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">+</span> <span class="s">", title: "</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">+</span> <span class="s">", belongs: "</span> <span class="o">+</span> <span class="n">user</span><span class="o">.</span><span class="na">name</span>
  <span class="o">}</span>
</pre></div>

<h3>test.scala</h3>

<div class="highlight"><pre>  <span class="kn">package</span> <span class="n">models</span>
  
  <span class="kn">import</span> <span class="nn">com.orientechnologies.orient.core.id.ORecordId</span>
  <span class="kn">import</span> <span class="nn">com.orientechnologies.orient.core.sql.query.OSQLSynchQuery</span>
  <span class="kn">import</span> <span class="nn">scala.collection.JavaConverters._</span>
  <span class="kn">import</span> <span class="nn">scala.collection.JavaConversions._</span>
  <span class="kn">import</span> <span class="nn">com.orientechnologies.orient.core.db.</span><span class="err">`</span><span class="n">object</span><span class="err">`</span><span class="o">.{</span><span class="n">ODatabaseObject</span><span class="o">,</span> <span class="n">ODatabaseObjectPool</span><span class="o">,</span> <span class="n">ODatabaseObjectTx</span><span class="o">}</span>
  
  <span class="n">object</span> <span class="n">Test</span> <span class="o">{</span>
  	<span class="n">implicit</span> <span class="n">def</span> <span class="nf">dbWrapper</span><span class="o">(</span><span class="nl">db:</span> <span class="n">ODatabaseObjectTx</span><span class="o">)</span> <span class="o">=</span> <span class="k">new</span> <span class="o">{</span>
  		<span class="n">def</span> <span class="n">queryBySql</span><span class="o">[</span><span class="n">T</span><span class="o">](</span><span class="nl">sql:</span> <span class="n">String</span><span class="o">,</span> <span class="nl">params:</span> <span class="n">AnyRef</span><span class="o">*):</span> <span class="n">List</span><span class="o">[</span><span class="n">T</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
  			<span class="n">val</span> <span class="n">params4java</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="na">toArray</span>
  			<span class="n">val</span> <span class="nl">results:</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span><span class="o">[</span><span class="n">T</span><span class="o">]</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="k">new</span> <span class="n">OSQLSynchQuery</span><span class="o">[[</span><span class="n">T</span><span class="o">|</span><span class="n">SQL</span><span class="o">]],</span> <span class="nl">params4java:</span> <span class="n">_</span><span class="o">*)</span>
  			<span class="n">results</span><span class="o">.</span><span class="na">asScala</span><span class="o">.</span><span class="na">toList</span>
  		<span class="o">}</span>
  	<span class="o">}</span>
  
  	<span class="n">def</span> <span class="nf">main</span><span class="o">(</span><span class="nl">args:</span> <span class="n">Array</span><span class="o">[</span><span class="n">String</span><span class="o">])</span> <span class="o">=</span> <span class="o">{</span>
  		<span class="c1">// ~~~~~~~~~~~~~ create db ~~~~~~~~~~~~~~~~~~~</span>
  		<span class="n">var</span> <span class="nl">uri:</span> <span class="n">String</span> <span class="o">=</span> <span class="s">"local:c:/orientdb2"</span>
  		<span class="n">var</span> <span class="nl">db:</span> <span class="n">ODatabaseObjectTx</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ODatabaseObjectTx</span><span class="o">(</span><span class="n">uri</span><span class="o">)</span>
  		<span class="k">if</span> <span class="o">(!</span><span class="n">db</span><span class="o">.</span><span class="na">exists</span><span class="o">)</span> <span class="o">{</span>
  			<span class="n">db</span><span class="o">.</span><span class="na">create</span><span class="o">()</span>
  		<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  			<span class="n">db</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="s">"admin"</span><span class="o">,</span> <span class="s">"admin"</span><span class="o">)</span>
  		<span class="o">}</span>
  
  		<span class="c1">// ~~~~~~~~~~~~ register models ~~~~~~~~~~~~~~~~</span>
  		<span class="n">db</span><span class="o">.</span><span class="na">getEntityManager</span><span class="o">.</span><span class="na">registerEntityClasses</span><span class="o">(</span><span class="s">"models"</span><span class="o">)</span>
  
  		<span class="c1">// ~~~~~~~~~~~~~ create some data ~~~~~~~~~~~~~~~~</span>
  		<span class="n">var</span> <span class="nl">user:</span> <span class="n">User</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span>
  		<span class="n">user</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="s">"aaa"</span>
  		<span class="n">db</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">)</span>
  
  		<span class="n">var</span> <span class="n">address1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Address</span>
  		<span class="n">address1</span><span class="o">.</span><span class="na">city</span> <span class="o">=</span> <span class="s">"NY"</span>
  		<span class="n">address1</span><span class="o">.</span><span class="na">street</span> <span class="o">=</span> <span class="s">"road1"</span>
  		<span class="n">var</span> <span class="n">address2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Address</span>
  		<span class="n">address2</span><span class="o">.</span><span class="na">city</span> <span class="o">=</span> <span class="s">"ST"</span>
  		<span class="n">address2</span><span class="o">.</span><span class="na">street</span> <span class="o">=</span> <span class="s">"road2"</span>
  
  		<span class="n">user</span><span class="o">.</span><span class="na">addresses</span> <span class="o">+=</span> <span class="n">address1</span>
  		<span class="n">user</span><span class="o">.</span><span class="na">addresses</span> <span class="o">+=</span> <span class="n">address2</span>
  		<span class="n">db</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">)</span>
  
  		<span class="n">var</span> <span class="n">q1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Question</span>
  		<span class="n">q1</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="s">"How to use orientdb in scala?"</span>
  		<span class="n">q1</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span>
  		<span class="n">db</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">q1</span><span class="o">)</span>
  
  		<span class="n">var</span> <span class="n">q2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Question</span>
  		<span class="n">q2</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="s">"Show me a demo"</span>
  		<span class="n">q2</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span>
  		<span class="n">db</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">q2</span><span class="o">)</span>
  
  		<span class="c1">// ~~~~~~~~~~~~~~~~ count them ~~~~~~~~~~~~~~~~</span>
  		<span class="n">val</span> <span class="n">userCount</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">countClass</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="n">User</span><span class="o">])</span>
  		<span class="n">println</span><span class="o">(</span><span class="s">"User count: "</span> <span class="o">+</span> <span class="n">userCount</span><span class="o">)</span>
  
  		<span class="n">val</span> <span class="n">questionCount</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">countClass</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="n">Question</span><span class="o">])</span>
  		<span class="n">println</span><span class="o">(</span><span class="s">"Question count: "</span> <span class="o">+</span> <span class="n">questionCount</span><span class="o">)</span>
  
  		<span class="c1">// ~~~~~~~~~~~~~~~~~ get all users ~~~~~~~~~~~~</span>
  		<span class="n">val</span> <span class="n">users</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">queryBySql</span><span class="o">[</span><span class="n">User</span><span class="o">](</span><span class="s">"select from User"</span><span class="o">)</span>
  		<span class="k">for</span> <span class="o">(</span><span class="n">user</span> <span class="o">&lt;-</span> <span class="n">users</span><span class="o">)</span> <span class="o">{</span>
  			<span class="n">println</span><span class="o">(</span><span class="s">" - user: "</span> <span class="o">+</span> <span class="n">user</span><span class="o">)</span>
  		<span class="o">}</span>
  
  		<span class="c1">// ~~~~~~~~~~~~~~~~~~ get the first user ~~~~~~~~</span>
  		<span class="n">val</span> <span class="n">firstUser</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">queryBySql</span><span class="o">[</span><span class="n">User</span><span class="o">](</span><span class="s">"select from User limit 1"</span><span class="o">).</span><span class="na">head</span>
  		<span class="n">println</span><span class="o">(</span><span class="s">"First user: "</span> <span class="o">+</span> <span class="n">firstUser</span><span class="o">)</span>
  
  		<span class="c1">// query by id</span>
  		<span class="n">val</span> <span class="n">userById</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">queryBySql</span><span class="o">[</span><span class="n">User</span><span class="o">](</span><span class="s">"select from User where @rid = ?"</span><span class="o">,</span> <span class="k">new</span> <span class="n">ORecordId</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">id</span><span class="o">))</span>
  		<span class="n">println</span><span class="o">(</span><span class="s">"User by id: "</span> <span class="o">+</span> <span class="n">userById</span><span class="o">)</span>
  
  		<span class="c1">// query by field</span>
  		<span class="n">val</span> <span class="n">userByField</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">queryBySql</span><span class="o">[</span><span class="n">User</span><span class="o">](</span><span class="s">"select from User where name = ?"</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">name</span><span class="o">)</span>
  		<span class="n">println</span><span class="o">(</span><span class="s">"User by field: "</span> <span class="o">+</span> <span class="n">userByField</span><span class="o">)</span>
  
  		<span class="c1">// query by city</span>
  		<span class="n">val</span> <span class="n">userByCity</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">queryBySql</span><span class="o">[</span><span class="n">User</span><span class="o">](</span><span class="s">"select from User where addresses contains ( city = ? )"</span><span class="o">,</span> <span class="s">"NY"</span><span class="o">)</span>
  		<span class="n">println</span><span class="o">(</span><span class="s">"User by city: "</span> <span class="o">+</span> <span class="n">userByCity</span><span class="o">)</span>
  
  		<span class="c1">// query questions of the user</span>
  		<span class="n">val</span> <span class="n">questions</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">queryBySql</span><span class="o">[</span><span class="n">Question</span><span class="o">](</span><span class="s">"select from Question where user = ?"</span><span class="o">,</span> <span class="n">user</span><span class="o">)</span>
  		<span class="k">for</span> <span class="o">(</span><span class="n">q</span> <span class="o">&lt;-</span> <span class="n">questions</span><span class="o">)</span> <span class="o">{</span>
  			<span class="n">println</span><span class="o">(</span><span class="s">" - question: "</span> <span class="o">+</span> <span class="n">q</span><span class="o">)</span>
  		<span class="o">}</span>
  
  		<span class="n">db</span><span class="o">.</span><span class="na">delete</span><span class="o">()</span>
  		<span class="n">db</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
  	<span class="o">}</span>
  <span class="o">}</span>
</pre></div>


  </div>

</div>

<footer>
  <div class="row">
    <div class="six columns">
      <ul class="inline-list">
        <li><a href="/orientdb/"> Home</a></li>
<li><a href="/orientdb/about.html"> About</a></li>
<li class="active"><a href="/orientdb/wiki/Home.html"> Documentation</a></li>
<li><a href="/orientdb/wiki/Download.html"> Downloads</a></li>
<li><a href="/orientdb/community.html"> Community</a></li>
      </ul>
    </div>
    <div class="six columns">
      <p class="copyright">
        Copyright &copy; 2011-2012 NuvolaBase Ltd. <br/>
        <span class="small">NuvolaBase is a registered trademark. All Rights Reserved.</span>
      </p>
    </div>
  </div>
</footer>

<script src="../javascripts/app.js" type="text/javascript"></script>

</body>
</html>