<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en" xmlns="http://www.w3.org/1999/html"><!--<![endif]-->
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
  <title>Java Traverse |  OrientDB</title>
  <title>Java Traverse</title>
  <link href="../stylesheets/foundation.min.css" media="screen" rel="stylesheet" type="text/css" />
<link href="../stylesheets/app.css" media="screen" rel="stylesheet" type="text/css" />
  <script src="../javascripts/modernizr.foundation.js" type="text/javascript"></script>
  
</head>
<body class="orientdb orientdb_wiki orientdb_wiki_Java-Traverse">

<header>
  <div class="row">
    <div class="five columns">
      <h1>
        <a href="/orientdb/">
          Orient<span class="highl">DB</span>
        </a>
        <span class="subtitle">The Document/Graph NoSQL Database</span>
      </h1>
    </div>
    <div class="seven columns right">
      <ul class="inline-list">
        <li><a href="/orientdb/"> Home</a></li>
<li><a href="/orientdb/about.html"> About</a></li>
<li class="active"><a href="/orientdb/wiki/Home.html"> Documentation</a></li>
<li><a href="/orientdb/wiki/Download.html"> Downloads</a></li>
<li><a href="/orientdb/community.html"> Community</a></li>
      </ul>
    </div>
  </div>
</header>


<div class="page-header">
  <div class="row">
    <div class="twelve columns">
      <h2>
        <i class="icon-orientdb"></i>
        Java Traverse
        
          <ul class="bcs">
          
            <li><a href="/orientdb/wiki/Java-API.html" class="nr1">Java Api</a></li>
          
            <li><a href="/orientdb/wiki/Home.html" class="nr2">Home</a></li>
          
          </ul>
        
        
      </h2>
    </div>
  </div>
</div>

<div id="main" class="row wiki">

  <div class="twelve columns content" role="content">

    <h3>Introduction</h3>

<p>OrientDB is a graph database. This means that the focal point is on relationships (links) and how are managed. The standard SQL language is not enough to work with tree or graphs because it hasn't the concept of recursion. This is the reason why OrientDB provide a new command to traverse trees and graphs: TRAVERSE. Traversing is the operation that cross relationships between records (documents, vertexes, nodes, etc). This operation is much much faster than executing a JOIN in a Relational database.</p>

<p>The main concepts of Traversal are:</p>

<ul>
<li>
<strong>target</strong>, as the starting point where to traverse records. Can be:</li>
<li><strong><a class="internal present" href="/orientdb/wiki/Concepts.html#class">class</a></strong></li>
<li><strong><a class="internal present" href="/orientdb/wiki/Concepts.html#cluster">cluster</a></strong></li>
<li>
<strong>set of records</strong>, specifying its <a class="internal present" href="/orientdb/wiki/Concepts.html#recordid">RecordID</a>
</li>
<li>
<strong>sub-command</strong> that returns an <code>Iterable&lt;OIdentifiable&gt;</code>. You can nest multiple <a href="SQLSelect">select</a> and <a class="internal present" href="/orientdb/wiki/SQL-Traverse.html">traverse</a> all together</li>
<li>
<strong>fields</strong>, the fields to traverse. Use <code>*</code>, <code>any()</code> or <code>all()</code> to traverse all the fields of a document</li>
<li>
<strong>limit</strong>, the maximum number of records to retrieve</li>
<li>
<strong>predicate</strong>, as the predicate to execute against each document traversed. If the predicate returns true, then the document is returned, otherwise is skipped</li>
</ul><p>During traversing some context variables are managed and can be used by the traverse condition:</p>

<ul>
<li>
<strong>$depth</strong>, as an integer that contain the depth level of nesting in traversal. First level is 0</li>
<li>
<strong>$path</strong>, as a string representation of the current position as the sum of traversed nodes</li>
<li>
<strong>$stack</strong>, as the stack current node traversed</li>
<li>
<strong>$history</strong>, as the entire collection of visited nodes</li>
</ul><p>Below how to traverse using different approaches.</p>

<h3>SQL Traverse</h3>

<p>The simpler available way to execute a traversal is using the <a class="internal present" href="/orientdb/wiki/SQL-Traverse.html">SQL Traverse command</a>. Example to retrieve all the records connected <strong>from</strong> and <strong>to</strong> <strong>Movie</strong> records up to the <strong>5th level of depth</strong>:
</p><div class="highlight"><pre>  for (OIdentifiable id : new OSQLSynchQuery<span class="nt">&lt;ODocument&gt;</span>("traverse in, out from Movie while $depth <span class="err">&lt;</span>= 5")) {
    System.out.println(id);
  }
</pre></div>

<p>Look at the <a class="internal present" href="/orientdb/wiki/SQL-Traverse.html">command syntax</a> for more information.</p>

<h3>Native Fluent API</h3>

<p><em>(Available since 1.0)</em>
Native API supports fluent execution guaranteeing compact and readable syntax. The main class is <strong><code>OTraverse</code></strong>:</p>

<ul>
<li>
<strong><code>target(&lt;iter:Iterable&lt;OIdentifiable&gt;&gt;)</code></strong>, to specify the target as any iterable object like collections or arrays of OIdentifiable objects.</li>
<li>
<strong><code>target(&lt;iter:Iterator&lt;OIdentifiable&gt;&gt;)</code></strong>, to specify the target as any iterator object. To specify a class use <code>database.browseClass(&lt;class-name&gt;).iterator()</code>
</li>
<li>
<strong><code>target(&lt;record:OIdentifiable&gt;, &lt;record:OIdentifiable&gt;, ... )</code></strong>, to specify the target as a var ars of OIterable objects</li>
<li>
<strong><code>field(&lt;field-name:string&gt;)</code></strong>, to specify the document's field to traverse. To add multiple field call this method in chain. Example: <code>.field("in").field("out")</code>
</li>
<li>
<strong><code>fields(&lt;field-name:string&gt;, &lt;field-name:string&gt;, ...)</code></strong>, to specify multiple fields in one call passing a var args of Strings</li>
<li>
<strong><code>fields(Collection&lt;field-name:string&gt;)</code></strong>, to specify multiple fields in one call passing a collection of String</li>
<li>
<strong><code>limit(&lt;max:int&gt;)</code></strong>, as the maximum number of record returned</li>
<li>
<strong><code>predicate(&lt;predicate:OCommandPredicate&gt;)</code></strong>, to specify a predicate to execute against each traversed record. If the predicate returns true, then the record is returned as result, otherwise false. it's common to create an anonymous class specifying the predicate at the fly</li>
<li>
<strong><code>predicate(&lt;predicate:OSQLPredicate&gt;)</code></strong>, to specify the predicate using the SQL syntax.</li>
</ul><p>In the traverse command context iContext you can read/put any variable. Traverse command updates these variables:</p>

<ul>
<li>
<strong>depth</strong>, as the current depth of nesting</li>
<li>
<strong>path</strong>, as the string representation of the current path. You can also display it. Example: <code>select $path from (traverse * from V)</code>
</li>
<li>
<strong>stack</strong>, as the List of operation in the stack. Use it to access to the history of the traversal. It's a <code>List&lt;OTraverseAbstractProcess&lt;?&gt;&gt;</code> where process implementations are:</li>
<li>
<strong><code>OTraverseRecordSetProcess</code></strong>, usually the first one it's the base target of traverse</li>
<li>
<strong><code>OTraverseRecordProcess</code></strong>, represent a traversed record</li>
<li>
<strong><code>OTraverseFieldProcess</code></strong>, represent a traversal through a record's field</li>
<li>
<strong><code>OTraverseMultiValueProcess</code></strong>, use on fields that are multivalue: arrays, collections and maps</li>
<li>
<strong>history</strong>, as the set of records traversed as a <code>Set&lt;ORID&gt;</code>.</li>
</ul><h4>Example using an anonymous OCommandPredicate as predicate</h4>

<div class="highlight"><pre>  <span class="k">for</span> <span class="o">(</span><span class="n">OIdentifiable</span> <span class="n">id</span> <span class="o">:</span> <span class="k">new</span> <span class="n">OTraverse</span><span class="o">()</span>
                <span class="o">.</span><span class="na">field</span><span class="o">(</span><span class="s">"in"</span><span class="o">).</span><span class="na">field</span><span class="o">(</span><span class="s">"out"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">target</span><span class="o">(</span> <span class="n">database</span><span class="o">.</span><span class="na">browseClass</span><span class="o">(</span><span class="s">"Movie"</span><span class="o">).</span><span class="na">iterator</span><span class="o">()</span> <span class="o">)</span>
                <span class="o">.</span><span class="na">predicate</span><span class="o">(</span><span class="k">new</span> <span class="n">OCommandPredicate</span><span class="o">()</span> <span class="o">{</span>
  
      <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">evaluate</span><span class="o">(</span><span class="n">ORecord</span><span class="o">&lt;?&gt;</span> <span class="n">iRecord</span><span class="o">,</span> <span class="n">OCommandContext</span> <span class="n">iContext</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">((</span><span class="n">Integer</span><span class="o">)</span> <span class="n">iContext</span><span class="o">.</span><span class="na">getVariable</span><span class="o">(</span><span class="s">"depth"</span><span class="o">))</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}))</span> <span class="o">{</span>
  
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>
</pre></div>

<h4>Example using the OSQLPredicate as predicate</h4>

<div class="highlight"><pre>  <span class="k">for</span> <span class="o">(</span><span class="n">OIdentifiable</span> <span class="n">id</span> <span class="o">:</span> <span class="k">new</span> <span class="n">OTraverse</span><span class="o">()</span>
                <span class="o">.</span><span class="na">field</span><span class="o">(</span><span class="s">"in"</span><span class="o">).</span><span class="na">field</span><span class="o">(</span><span class="s">"out"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">target</span><span class="o">(</span><span class="n">database</span><span class="o">.</span><span class="na">browseClass</span><span class="o">(</span><span class="s">"Movie"</span><span class="o">).</span><span class="na">iterator</span><span class="o">())</span>
                <span class="o">.</span><span class="na">predicate</span><span class="o">(</span> <span class="k">new</span> <span class="n">OSQLPredicate</span><span class="o">(</span><span class="s">"$depth &lt;= 5"</span><span class="o">)))</span> <span class="o">{</span>
  
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>
</pre></div>

<h3>= Other example</h3>

<p>OTraverse gets any Iterable, Iterator and Single/Multi OIdentifiable. There's also the limit() clause. To specify multiple fields use fields(). Full example:
</p><div class="highlight"><pre>  <span class="k">for</span> <span class="o">(</span><span class="n">OIdentifiable</span> <span class="n">id</span> <span class="o">:</span> <span class="k">new</span> <span class="n">OTraverse</span><span class="o">()</span>
                <span class="o">.</span><span class="na">target</span><span class="o">(</span><span class="k">new</span> <span class="n">ORecordId</span><span class="o">(</span><span class="s">"#6:0"</span><span class="o">),</span> <span class="k">new</span> <span class="n">ORecordId</span><span class="o">(</span><span class="s">"#6:1"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">fields</span><span class="o">(</span><span class="s">"out"</span><span class="o">,</span> <span class="s">"int"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">limit</span><span class="o">(</span><span class="mi">100</span><span class="o">)</span>
                <span class="o">.</span><span class="na">predicate</span><span class="o">(</span> <span class="k">new</span> <span class="n">OSQLPredicate</span><span class="o">(</span><span class="s">"$depth &lt;= 10"</span><span class="o">)))</span> <span class="o">{</span>
  
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span> <span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>
</pre></div>


  </div>

</div>

<footer>
  <div class="row">
    <div class="six columns">
      <ul class="inline-list">
        <li><a href="/orientdb/"> Home</a></li>
<li><a href="/orientdb/about.html"> About</a></li>
<li class="active"><a href="/orientdb/wiki/Home.html"> Documentation</a></li>
<li><a href="/orientdb/wiki/Download.html"> Downloads</a></li>
<li><a href="/orientdb/community.html"> Community</a></li>
      </ul>
    </div>
    <div class="six columns">
      <p class="copyright">
        Copyright &copy; 2011-2012 NuvolaBase Ltd. <br/>
        <span class="small">NuvolaBase is a registered trademark. All Rights Reserved.</span>
      </p>
    </div>
  </div>
</footer>

<script src="../javascripts/app.js" type="text/javascript"></script>

</body>
</html>